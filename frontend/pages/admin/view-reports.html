<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emergency Reports - FloodResponse Admin</title>
    <link rel="stylesheet" href="../../css/main.css">
    <link rel="stylesheet" href="../../css/admin.css">
    <link rel="stylesheet" href="../../css/components.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>

<body>
    <div class="admin-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2><i class="fas fa-water"></i> Admin</h2>
            </div>
            <ul class="sidebar-menu">
                <li><a href="dashboard.html"><i class="fas fa-tachometer-alt"></i> <span>Dashboard</span></a></li>
                <li><a href="manage-alerts.html"><i class="fas fa-bell"></i> <span>Alerts</span></a></li>
                <li><a href="manage-shelters.html"><i class="fas fa-home"></i> <span>Shelters</span></a></li>
                <li><a href="manage-helplines.html"><i class="fas fa-phone"></i> <span>Helplines</span></a></li>
                <li><a href="view-reports.html" class="active"><i class="fas fa-file-alt"></i> <span>Reports</span></a>
                </li>
                <li><a href="../user/index.html"><i class="fas fa-sign-out-alt"></i> <span>Logout</span></a></li>
            </ul>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <div class="admin-header">
                <h2>Emergency Reports</h2>
                <div class="filters">
                    <button class="filter-btn active">All</button>
                    <button class="filter-btn">Pending</button>
                    <button class="filter-btn">In Progress</button>
                    <button class="filter-btn">Resolved</button>
                </div>
            </div>

            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Reporter</th>
                            <th>Type</th>
                            <th>Location</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>#1023</td>
                            <td>Ali Khan</td>
                            <td>Flood</td>
                            <td>Model Town, Lahore</td>
                            <td><span class="alert-badge alert-warning">Pending</span></td>
                            <td>
                                <button class="action-btn btn-edit" onclick="openModal('viewReportModal')">View</button>
                                <button class="action-btn btn-success"><i class="fas fa-check"></i></button>
                            </td>
                        </tr>
                        <tr>
                            <td>#1022</td>
                            <td>Sara Ahmed</td>
                            <td>Medical</td>
                            <td>Dadu, Sindh</td>
                            <td><span class="alert-badge alert-info">In Progress</span></td>
                            <td>
                                <button class="action-btn btn-edit" onclick="openModal('viewReportModal')">View</button>
                                <button class="action-btn btn-success"><i class="fas fa-check"></i></button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </main>
    </div>

    <!-- View Report Modal -->
    <div id="viewReportModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('viewReportModal')">&times;</span>
            <h2>Report Details #1023</h2>
            <div class="mt-3">
                <p><strong>Reporter:</strong> Ali Khan</p>
                <p><strong>Contact:</strong> 0300-1234567</p>
                <p><strong>Type:</strong> Flood Water Entering Home</p>
                <p><strong>Location:</strong> Model Town, Lahore (Lat: 31.5, Lng: 74.3)</p>
                <p><strong>Time:</strong> 30 Nov 2025, 10:15 AM</p>
                <div class="mt-3 p-3 bg-light rounded">
                    <strong>Description:</strong><br>
                    Water has entered the ground floor. Need immediate evacuation assistance. 4 family members trapped.
                </div>
                <div class="mt-3">
                    <label><strong>Update Status:</strong></label>
                    <select class="form-control mt-1">
                        <option value="Pending">Pending</option>
                        <option value="In Progress">In Progress</option>
                        <option value="Resolved">Resolved</option>
                    </select>
                </div>
                <!DOCTYPE html>
                <html lang="en">

                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>Emergency Reports - FloodResponse Admin</title>
                    <link rel="stylesheet" href="../../css/main.css">
                    <link rel="stylesheet" href="../../css/admin.css">
                    <link rel="stylesheet" href="../../css/components.css">
                    <link rel="stylesheet"
                        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
                </head>

                <body>
                    <div class="admin-container">
                        <!-- Sidebar -->
                        <aside class="sidebar">
                            <div class="sidebar-header">
                                <h2><i class="fas fa-water"></i> Admin</h2>
                            </div>
                            <ul class="sidebar-menu">
                                <li><a href="dashboard.html"><i class="fas fa-tachometer-alt"></i>
                                        <span>Dashboard</span></a></li>
                                <li><a href="manage-alerts.html"><i class="fas fa-bell"></i> <span>Alerts</span></a>
                                </li>
                                <li><a href="manage-shelters.html"><i class="fas fa-home"></i> <span>Shelters</span></a>
                                </li>
                                <li><a href="manage-helplines.html"><i class="fas fa-phone"></i>
                                        <span>Helplines</span></a></li>
                                <li><a href="view-reports.html" class="active"><i class="fas fa-file-alt"></i>
                                        <span>Reports</span></a>
                                </li>
                                <li><a href="../user/index.html"><i class="fas fa-sign-out-alt"></i>
                                        <span>Logout</span></a></li>
                            </ul>
                        </aside>

                        <!-- Main Content -->
                        <main class="main-content">
                            <div class="admin-header">
                                <h2>Emergency Reports</h2>
                                <div class="filters">
                                    <button class="filter-btn active">All</button>
                                    <button class="filter-btn">Pending</button>
                                    <button class="filter-btn">In Progress</button>
                                    <button class="filter-btn">Resolved</button>
                                </div>
                            </div>

                            <div class="table-container">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Reporter</th>
                                            <th>Type</th>
                                            <th>Location</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>#1023</td>
                                            <td>Ali Khan</td>
                                            <td>Flood</td>
                                            <td>Model Town, Lahore</td>
                                            <td><span class="alert-badge alert-warning">Pending</span></td>
                                            <td>
                                                <button class="action-btn btn-edit"
                                                    onclick="openModal('viewReportModal')">View</button>
                                                <button class="action-btn btn-success"><i
                                                        class="fas fa-check"></i></button>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>#1022</td>
                                            <td>Sara Ahmed</td>
                                            <td>Medical</td>
                                            <td>Dadu, Sindh</td>
                                            <td><span class="alert-badge alert-info">In Progress</span></td>
                                            <td>
                                                <button class="action-btn btn-edit"
                                                    onclick="openModal('viewReportModal')">View</button>
                                                <button class="action-btn btn-success"><i
                                                        class="fas fa-check"></i></button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </main>
                    </div>

                    <!-- View Report Modal -->
                    <div id="viewReportModal" class="modal">
                        <div class="modal-content">
                            <span class="close-modal" onclick="closeModal('viewReportModal')">&times;</span>
                            <h2>Report Details #1023</h2>
                            <div class="mt-3">
                                <p><strong>Reporter:</strong> Ali Khan</p>
                                <p><strong>Contact:</strong> 0300-1234567</p>
                                <p><strong>Type:</strong> Flood Water Entering Home</p>
                                <p><strong>Location:</strong> Model Town, Lahore (Lat: 31.5, Lng: 74.3)</p>
                                <p><strong>Time:</strong> 30 Nov 2025, 10:15 AM</p>
                                <div class="mt-3 p-3 bg-light rounded">
                                    <strong>Description:</strong><br>
                                    Water has entered the ground floor. Need immediate evacuation assistance. 4 family
                                    members trapped.
                                </div>
                                <div class="mt-3">
                                    <label><strong>Update Status:</strong></label>
                                    <select class="form-control mt-1">
                                        <option value="Pending">Pending</option>
                                        <option value="In Progress">In Progress</option>
                                        <option value="Resolved">Resolved</option>
                                    </select>
                                </div>
                                <button class="btn btn-primary mt-3">Update Status</button>
                            </div>
                        </div>
                    </div>

                    <script src="../../js/utils.js"></script>
                    <script src="../../js/api.js"></script>
                    <script>
                        // State
                        let reports = [];

                        // DOM Elements
                        const reportsTableBody = document.querySelector('.data-table tbody');
                        const modalContent = document.querySelector('.modal-content .mt-3');

                        // Initialize
                        document.addEventListener('DOMContentLoaded', () => {
                            fetchReports();
                        });

                        // Fetch Reports
                        async function fetchReports() {
                            try {
                                reports = await api.getReports();
                                renderTable(reports);
                            } catch (error) {
                                console.error('Error fetching reports:', error);
                                utils.showToast('Failed to load reports', 'error');
                            }
                        }

                        // Render Table
                        function renderTable(data) {
                            reportsTableBody.innerHTML = data.map(report => `
                <tr>
                    <td>#${report.id}</td>
                    <td>${report.reporterName}</td>
                    <td>${report.emergencyType}</td>
                    <td>${report.location}</td>
                    <td><span class="alert-badge ${getStatusBadgeClass(report.status)}">${report.status}</span></td>
                    <td>
                        <button class="action-btn btn-edit" onclick="viewReport(${report.id})">View</button>
                    </td>
                </tr>
            `).join('');
                        }

                        function getStatusBadgeClass(status) {
                            switch (status) {
                                case 'Pending': return 'alert-warning';
                                case 'In Progress': return 'alert-info';
                                case 'Resolved': return 'alert-success';
                                default: return 'alert-secondary';
                            }
                        }

                        // View Report Details
                        window.viewReport = function (id) {
                            const report = reports.find(r => r.id === id);
                            if (!report) return;

                            const date = new Date(report.reportedAt).toLocaleString();

                            modalContent.innerHTML = `
                <p><strong>Reporter:</strong> ${report.reporterName}</p>
                <p><strong>Contact:</strong> ${report.contactNumber}</p>
                <p><strong>Type:</strong> ${report.emergencyType}</p>
                <p><strong>Location:</strong> ${report.location} ${report.latitude ? `(Lat: ${report.latitude}, Lng: ${report.longitude})` : ''}</p>
                <p><strong>Time:</strong> ${date}</p>
                <div class="mt-3 p-3 bg-light rounded">
                    <strong>Description:</strong><br>
                    ${report.description}
                </div>
                <div class="mt-3">
                    <label><strong>Update Status:</strong></label>
                    <select class="form-control mt-1" id="statusSelect-${report.id}">
                        <option value="Pending" ${report.status === 'Pending' ? 'selected' : ''}>Pending</option>
                        <option value="In Progress" ${report.status === 'In Progress' ? 'selected' : ''}>In Progress</option>
                        <option value="Resolved" ${report.status === 'Resolved' ? 'selected' : ''}>Resolved</option>
                    </select>
                </div>
                <button class="btn btn-primary mt-3" onclick="updateStatus(${report.id})">Update Status</button>
            `;

                            document.querySelector('#viewReportModal h2').textContent = `Report Details #${report.id}`;
                            openModal('viewReportModal');
                        }

                        // Update Status (Mock implementation for now, as API update endpoint might not exist yet)
                        window.updateStatus = async function (id) {
                            const newStatus = document.getElementById(`statusSelect-${id}`).value;
                            // In a real app, you would call api.updateReportStatus(id, newStatus)
                            // For now, let's just update local state and UI

                            // If you have an update endpoint:
                            // await api.updateReport(id, { status: newStatus });

                            utils.showToast(`Status updated to ${newStatus}`, 'success');
                            closeModal('viewReportModal');
                            fetchReports(); // Refresh list
                        }

                        // Filter Buttons
                        document.querySelectorAll('.filter-btn').forEach(btn => {
                            btn.addEventListener('click', (e) => {
                                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                                e.target.classList.add('active');

                                const filter = e.target.textContent;
                                if (filter === 'All') {
                                    renderTable(reports);
                                } else {
                                    const filtered = reports.filter(r => r.status === filter);
                                    renderTable(filtered);
                                }
                            });
                        });

                        function openModal(id) {
                            document.getElementById(id).style.display = 'block';
                        }
                        function closeModal(id) {
                            document.getElementById(id).style.display = 'none';
                        }
                        window.onclick = function (event) {
                            if (event.target.className === 'modal') {
                                event.target.style.display = "none";
                            }
                        }
                    </script>
                </body>

                </html>